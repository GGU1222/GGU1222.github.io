---
title: "Sample3"
excerpt: "excerpt"

categories:
  - category

tags:
  - [tag]

toc: true

date: 2021-12-27
---

```python
from bs4 import BeautifulSoup
import requests
import pandas as pd
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error
import matplotlib.pyplot as plt
import seaborn as sns
```


```python
seasons = ['2017-2018', '2018-2019', '2019-2020']
df = pd.DataFrame()

for ind, season in enumerate(seasons) :
  # Basic Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_stat = pd.DataFrame(columns=headers[1:20])

  for i in table.find_all('tr')[1:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_stat.loc[len(df_stat)] = row
    
  df_stat = df_stat.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_stat = df_stat.drop(columns=['Country', 'Top Team Scorer',	'Goalkeeper'])
  df_stat['Attendance'] = df_stat['Attendance'].str.replace(",", "")
  df_stat = df_stat.apply(pd.to_numeric)
  df_stat['WinRate'] = df_stat['W']/df_stat['MP']
  df_stat = df_stat.drop(columns=['LgRk', 'MP', 'W', 'D', 'L', 'GF', 'GA', 'GD', 'Pts', 'Pts/G', 'xG', 'xGA', 'xGD', 'xGD/90'])

  # Goalkeeping Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/keepers/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_goalkeep = pd.DataFrame(columns=headers[5:27])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_goalkeep.loc[len(df_goalkeep)] = row

  df_goalkeep = df_goalkeep.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_goalkeep = df_goalkeep.drop(columns=['Comp'])
  df_goalkeep['Min'] = df_goalkeep['Min'].str.replace(",", "")
  df_goalkeep = df_goalkeep.apply(pd.to_numeric)
  df_goalkeep = df_goalkeep.drop(columns=['# Pl', 'MP', 'Starts', 'Min', '90s', 'GA', 'GA90', 'W', 'D', 'L'])
  df_goalkeep.columns = ['SoTA', 'Saves', 'Save%', 'CS', 'CS%', 'PK_PKatt', 'PKA', 'PKsv', 'PKm', 'PK_Save%']

  # Shooting Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/shooting/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_shoot = pd.DataFrame(columns=headers[5:26])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_shoot.loc[len(df_shoot)] = row

  df_shoot = df_shoot.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_shoot = df_shoot.drop(columns=['Comp'])
  df_shoot = df_shoot.apply(pd.to_numeric)
  df_shoot = df_shoot.drop(columns=['# Pl', '90s', 'Gls', 'xG', 'npxG', 'npxG/Sh', 'G-xG', 'np:G-xG'])

  # Passing Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/passing/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_pass = pd.DataFrame(columns=headers[8:34])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_pass.loc[len(df_pass)] = row

  df_pass = df_pass.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_pass = df_pass.drop(columns=['Comp'])
  df_pass = df_pass.apply(pd.to_numeric)
  df_pass = df_pass.drop(columns=['# Pl', '90s', 'Ast', 'xA', 'A-xA'])
  df_pass.columns = ['T_Cmp', 'T_Att', 'T_Cmp%', 'Pass_TotDist', 'Pass_PrgDist', 'S_Cmp', 'S_Att', 'S_Cmp%', 'M_Cmp', 'M_Att', 'M_Cmp%', 'L_Cmp', 'L_Att', 'L_Cmp%', 'KP', '1/3', 'PPA', 'CrsPA', 'Prog']

  # Goal and Shot Creation Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/gca/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_gca = pd.DataFrame(columns=headers[7:27])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_gca.loc[len(df_gca)] = row

  df_gca = df_gca.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_gca = df_gca.drop(columns=['Comp'])
  df_gca = df_gca.apply(pd.to_numeric)
  df_gca = df_gca.drop(columns=['# Pl', '90s'])
  df_gca.columns = ['SCA', 'SCA90', 'S_PassLive', 'S_PassDead', 'S_Drib', 'S_Sh', 'S_Fld', 'S_Def', 'GCA', 'GCA90', 'G_PassLive', 'G_PassDead', 'G_Drib', 'G_Sh', 'G_Fld', 'G_Def']
  df_gca = df_gca.drop(columns=['GCA', 'GCA90', 'G_PassLive', 'G_PassDead', 'G_Drib', 'G_Sh', 'G_Fld', 'G_Def'])

  # Defensive Actions Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/defense/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_defense = pd.DataFrame(columns=headers[8:35])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_defense.loc[len(df_defense)] = row

  df_defense = df_defense.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_defense = df_defense.drop(columns=['Comp'])
  df_defense = df_defense.apply(pd.to_numeric)
  df_defense = df_defense.drop(columns=['# Pl', '90s'])
  df_defense.columns = ['Tkl', 'TklW', 'T_Def 3rd', 'T_Mid 3rd', 'T_Att 3rd', 'D_Tkl', 'D_Tkl+Past', 'Tkl%', 'Past', 'Press', 'Press_Succ', '%', 'P_Def 3rd', 'P_Mid 3rd', 'P_Att 3rd', 'Blocks', 'Block_Sh', 'ShSv', 'Pass', 'Int', 'Tkl+Int', 'Clr', 'Err']

  # Possession Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/possession/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_possess = pd.DataFrame(columns=headers[7:36])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_possess.loc[len(df_possess)] = row

  df_possess = df_possess.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_possess = df_possess.drop(columns=['Comp'])
  df_possess = df_possess.apply(pd.to_numeric)
  df_possess = df_possess.drop(columns=['# Pl', '90s'])
  df_possess.columns = ['Poss', 'Touches', 'Def Pen', 'Def 3rd', 'Mid 3rd', 'Att 3rd', 'Att Pen', 'Live', 'Succ', 'Att', 'Succ%', '#Pl', 'Megs', 'Carries', 'TotDist', 'PrgDist', 'Carry_Prog', 'Carry_1/3', 'CPA', 'Mis', 'Dis', 'Targ', 'Rec', 'Rec%', 'Receive_Prog']

  # Miscellaneous Stats
  url = 'https://fbref.com/en/comps/Big5/'+season+'/misc/squads/'+season+'-Big-5-European-Leagues-Stats'

  response = requests.get(url)
  html = response.text
  soup = BeautifulSoup(html, 'html.parser')
  tables = soup.find_all(name='table')
  for table in tables :
    headers = [th.text for th in table.find_all('th')]

  table = tables[0]
  headers = [th.text for th in table.find_all('th')]

  df_misc = pd.DataFrame(columns=headers[5:25])

  for i in table.find_all('tr')[2:] :
    data = i.find_all('td')
    row = [tr.text.strip() for tr in data]
    df_misc.loc[len(df_misc)] = row

  df_misc = df_misc.set_index('Squad', drop=True).rename_axis(None).sort_index()
  df_misc = df_misc.drop(columns=['Comp'])
  df_misc = df_misc.apply(pd.to_numeric)
  df_misc = df_misc.drop(columns=['# Pl', '90s', 'Int', 'TklW'])

  df_season = pd.concat((df_stat, df_goalkeep, df_shoot, df_pass, df_gca, df_defense, df_possess, df_misc), axis=1)
  df = pd.concat((df, df_season))
  print(ind)
```

    0
    1
    2
    


```python
df.to_csv('df_football.csv', encoding='utf-8-sig')
df = df.dropna()
df
```





  <div id="df-522b8b6a-d654-4fa4-b79d-fc58e44f0dab">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Attendance</th>
      <th>WinRate</th>
      <th>SoTA</th>
      <th>Saves</th>
      <th>Save%</th>
      <th>CS</th>
      <th>CS%</th>
      <th>PK_PKatt</th>
      <th>PKA</th>
      <th>PKsv</th>
      <th>PKm</th>
      <th>PK_Save%</th>
      <th>Sh</th>
      <th>SoT</th>
      <th>SoT%</th>
      <th>Sh/90</th>
      <th>SoT/90</th>
      <th>G/Sh</th>
      <th>G/SoT</th>
      <th>Dist</th>
      <th>FK</th>
      <th>PK</th>
      <th>PKatt</th>
      <th>T_Cmp</th>
      <th>T_Att</th>
      <th>T_Cmp%</th>
      <th>Pass_TotDist</th>
      <th>Pass_PrgDist</th>
      <th>S_Cmp</th>
      <th>S_Att</th>
      <th>S_Cmp%</th>
      <th>M_Cmp</th>
      <th>M_Att</th>
      <th>M_Cmp%</th>
      <th>L_Cmp</th>
      <th>L_Att</th>
      <th>L_Cmp%</th>
      <th>KP</th>
      <th>1/3</th>
      <th>PPA</th>
      <th>...</th>
      <th>Err</th>
      <th>Poss</th>
      <th>Touches</th>
      <th>Def Pen</th>
      <th>Def 3rd</th>
      <th>Mid 3rd</th>
      <th>Att 3rd</th>
      <th>Att Pen</th>
      <th>Live</th>
      <th>Succ</th>
      <th>Att</th>
      <th>Succ%</th>
      <th>#Pl</th>
      <th>Megs</th>
      <th>Carries</th>
      <th>TotDist</th>
      <th>PrgDist</th>
      <th>Carry_Prog</th>
      <th>Carry_1/3</th>
      <th>CPA</th>
      <th>Mis</th>
      <th>Dis</th>
      <th>Targ</th>
      <th>Rec</th>
      <th>Rec%</th>
      <th>Receive_Prog</th>
      <th>CrdY</th>
      <th>CrdR</th>
      <th>2CrdY</th>
      <th>Fls</th>
      <th>Fld</th>
      <th>Off</th>
      <th>Crs</th>
      <th>PKwon</th>
      <th>PKcon</th>
      <th>OG</th>
      <th>Recov</th>
      <th>Won</th>
      <th>Lost</th>
      <th>Won%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alavés</th>
      <td>18845</td>
      <td>0.394737</td>
      <td>177</td>
      <td>136</td>
      <td>75.7</td>
      <td>12</td>
      <td>31.6</td>
      <td>11</td>
      <td>7</td>
      <td>3</td>
      <td>1</td>
      <td>30.0</td>
      <td>393</td>
      <td>137</td>
      <td>34.9</td>
      <td>10.34</td>
      <td>3.61</td>
      <td>0.10</td>
      <td>0.28</td>
      <td>18.3</td>
      <td>22</td>
      <td>1</td>
      <td>3</td>
      <td>9346</td>
      <td>13461</td>
      <td>69.4</td>
      <td>190290</td>
      <td>78386</td>
      <td>3814</td>
      <td>4784</td>
      <td>79.7</td>
      <td>3832</td>
      <td>5009</td>
      <td>76.5</td>
      <td>1581</td>
      <td>3252</td>
      <td>48.6</td>
      <td>266</td>
      <td>817</td>
      <td>193</td>
      <td>...</td>
      <td>10</td>
      <td>39.8</td>
      <td>17627</td>
      <td>2150</td>
      <td>6162</td>
      <td>8241</td>
      <td>4235</td>
      <td>639</td>
      <td>16164</td>
      <td>358</td>
      <td>552</td>
      <td>64.9</td>
      <td>395</td>
      <td>23</td>
      <td>10639</td>
      <td>52772</td>
      <td>26536</td>
      <td>1004</td>
      <td>322</td>
      <td>110</td>
      <td>448</td>
      <td>370</td>
      <td>11683</td>
      <td>9346</td>
      <td>80.0</td>
      <td>1243</td>
      <td>105.0</td>
      <td>4.0</td>
      <td>4</td>
      <td>614</td>
      <td>531</td>
      <td>111</td>
      <td>371</td>
      <td>3</td>
      <td>10</td>
      <td>2</td>
      <td>3509</td>
      <td>376</td>
      <td>381</td>
      <td>49.7</td>
    </tr>
    <tr>
      <th>Athletic Club</th>
      <td>37246</td>
      <td>0.263158</td>
      <td>161</td>
      <td>118</td>
      <td>71.4</td>
      <td>11</td>
      <td>28.9</td>
      <td>6</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>50.0</td>
      <td>434</td>
      <td>150</td>
      <td>34.6</td>
      <td>11.42</td>
      <td>3.95</td>
      <td>0.08</td>
      <td>0.22</td>
      <td>15.4</td>
      <td>10</td>
      <td>6</td>
      <td>8</td>
      <td>12708</td>
      <td>17079</td>
      <td>74.4</td>
      <td>271525</td>
      <td>97224</td>
      <td>4455</td>
      <td>5570</td>
      <td>80.0</td>
      <td>5756</td>
      <td>7019</td>
      <td>82.0</td>
      <td>2390</td>
      <td>4088</td>
      <td>58.5</td>
      <td>315</td>
      <td>1188</td>
      <td>313</td>
      <td>...</td>
      <td>10</td>
      <td>49.7</td>
      <td>21099</td>
      <td>2132</td>
      <td>6403</td>
      <td>10287</td>
      <td>5825</td>
      <td>855</td>
      <td>19702</td>
      <td>324</td>
      <td>548</td>
      <td>59.1</td>
      <td>361</td>
      <td>26</td>
      <td>13660</td>
      <td>74758</td>
      <td>39197</td>
      <td>1551</td>
      <td>507</td>
      <td>108</td>
      <td>456</td>
      <td>334</td>
      <td>15390</td>
      <td>12708</td>
      <td>82.6</td>
      <td>1608</td>
      <td>93.0</td>
      <td>0.0</td>
      <td>0</td>
      <td>538</td>
      <td>495</td>
      <td>107</td>
      <td>538</td>
      <td>7</td>
      <td>6</td>
      <td>3</td>
      <td>3627</td>
      <td>440</td>
      <td>337</td>
      <td>56.6</td>
    </tr>
    <tr>
      <th>Atlético Madrid</th>
      <td>52707</td>
      <td>0.605263</td>
      <td>129</td>
      <td>109</td>
      <td>83.7</td>
      <td>23</td>
      <td>60.5</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
      <td>0</td>
      <td>75.0</td>
      <td>416</td>
      <td>152</td>
      <td>36.5</td>
      <td>10.95</td>
      <td>4.00</td>
      <td>0.13</td>
      <td>0.35</td>
      <td>17.3</td>
      <td>12</td>
      <td>4</td>
      <td>5</td>
      <td>14162</td>
      <td>18218</td>
      <td>77.7</td>
      <td>263545</td>
      <td>94131</td>
      <td>6334</td>
      <td>7435</td>
      <td>85.2</td>
      <td>5786</td>
      <td>6937</td>
      <td>83.4</td>
      <td>1839</td>
      <td>3341</td>
      <td>55.0</td>
      <td>298</td>
      <td>1153</td>
      <td>271</td>
      <td>...</td>
      <td>13</td>
      <td>47.3</td>
      <td>22528</td>
      <td>2086</td>
      <td>7072</td>
      <td>10958</td>
      <td>5949</td>
      <td>845</td>
      <td>21203</td>
      <td>365</td>
      <td>594</td>
      <td>61.4</td>
      <td>407</td>
      <td>25</td>
      <td>15484</td>
      <td>76000</td>
      <td>38921</td>
      <td>1576</td>
      <td>491</td>
      <td>150</td>
      <td>454</td>
      <td>388</td>
      <td>16640</td>
      <td>14162</td>
      <td>85.1</td>
      <td>1592</td>
      <td>93.0</td>
      <td>5.0</td>
      <td>3</td>
      <td>541</td>
      <td>483</td>
      <td>110</td>
      <td>350</td>
      <td>3</td>
      <td>4</td>
      <td>0</td>
      <td>3591</td>
      <td>340</td>
      <td>288</td>
      <td>54.1</td>
    </tr>
    <tr>
      <th>Barcelona</th>
      <td>67142</td>
      <td>0.736842</td>
      <td>136</td>
      <td>109</td>
      <td>80.1</td>
      <td>19</td>
      <td>50.0</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>581</td>
      <td>264</td>
      <td>45.4</td>
      <td>15.29</td>
      <td>6.95</td>
      <td>0.16</td>
      <td>0.35</td>
      <td>15.9</td>
      <td>59</td>
      <td>3</td>
      <td>5</td>
      <td>21306</td>
      <td>24812</td>
      <td>85.9</td>
      <td>389761</td>
      <td>119736</td>
      <td>9338</td>
      <td>10408</td>
      <td>89.7</td>
      <td>9224</td>
      <td>10257</td>
      <td>89.9</td>
      <td>2512</td>
      <td>3543</td>
      <td>70.9</td>
      <td>418</td>
      <td>1723</td>
      <td>513</td>
      <td>...</td>
      <td>12</td>
      <td>63.1</td>
      <td>28834</td>
      <td>2273</td>
      <td>7716</td>
      <td>14165</td>
      <td>9030</td>
      <td>1389</td>
      <td>27625</td>
      <td>617</td>
      <td>953</td>
      <td>64.7</td>
      <td>673</td>
      <td>35</td>
      <td>22156</td>
      <td>109504</td>
      <td>58996</td>
      <td>2436</td>
      <td>826</td>
      <td>252</td>
      <td>444</td>
      <td>401</td>
      <td>23805</td>
      <td>21306</td>
      <td>89.5</td>
      <td>2023</td>
      <td>67.0</td>
      <td>2.0</td>
      <td>0</td>
      <td>390</td>
      <td>528</td>
      <td>136</td>
      <td>383</td>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>3158</td>
      <td>242</td>
      <td>179</td>
      <td>57.5</td>
    </tr>
    <tr>
      <th>Betis</th>
      <td>46781</td>
      <td>0.473684</td>
      <td>153</td>
      <td>99</td>
      <td>62.1</td>
      <td>13</td>
      <td>34.2</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>25.0</td>
      <td>412</td>
      <td>161</td>
      <td>39.1</td>
      <td>10.84</td>
      <td>4.24</td>
      <td>0.13</td>
      <td>0.34</td>
      <td>18.4</td>
      <td>21</td>
      <td>2</td>
      <td>3</td>
      <td>17395</td>
      <td>21045</td>
      <td>82.7</td>
      <td>339463</td>
      <td>103592</td>
      <td>6739</td>
      <td>7725</td>
      <td>87.2</td>
      <td>8207</td>
      <td>9279</td>
      <td>88.4</td>
      <td>2330</td>
      <td>3674</td>
      <td>63.4</td>
      <td>310</td>
      <td>1235</td>
      <td>249</td>
      <td>...</td>
      <td>11</td>
      <td>57.7</td>
      <td>24882</td>
      <td>2519</td>
      <td>8155</td>
      <td>12664</td>
      <td>5697</td>
      <td>694</td>
      <td>23696</td>
      <td>392</td>
      <td>580</td>
      <td>67.6</td>
      <td>417</td>
      <td>24</td>
      <td>18494</td>
      <td>93912</td>
      <td>48719</td>
      <td>1843</td>
      <td>573</td>
      <td>153</td>
      <td>459</td>
      <td>367</td>
      <td>19397</td>
      <td>17395</td>
      <td>89.7</td>
      <td>1473</td>
      <td>90.0</td>
      <td>3.0</td>
      <td>1</td>
      <td>474</td>
      <td>498</td>
      <td>63</td>
      <td>375</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>3173</td>
      <td>258</td>
      <td>304</td>
      <td>45.9</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Watford</th>
      <td>15353</td>
      <td>0.210526</td>
      <td>166</td>
      <td>109</td>
      <td>66.3</td>
      <td>9</td>
      <td>23.7</td>
      <td>9</td>
      <td>8</td>
      <td>1</td>
      <td>0</td>
      <td>11.1</td>
      <td>410</td>
      <td>114</td>
      <td>27.8</td>
      <td>10.79</td>
      <td>3.00</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>16.5</td>
      <td>18</td>
      <td>7</td>
      <td>8</td>
      <td>11208</td>
      <td>15407</td>
      <td>72.7</td>
      <td>221889</td>
      <td>84866</td>
      <td>4849</td>
      <td>5746</td>
      <td>84.4</td>
      <td>4286</td>
      <td>5331</td>
      <td>80.4</td>
      <td>1790</td>
      <td>3639</td>
      <td>49.2</td>
      <td>287</td>
      <td>889</td>
      <td>268</td>
      <td>...</td>
      <td>12</td>
      <td>42.5</td>
      <td>19952</td>
      <td>2259</td>
      <td>6459</td>
      <td>9064</td>
      <td>5455</td>
      <td>877</td>
      <td>18176</td>
      <td>360</td>
      <td>618</td>
      <td>58.3</td>
      <td>382</td>
      <td>15</td>
      <td>11603</td>
      <td>54910</td>
      <td>29135</td>
      <td>1198</td>
      <td>361</td>
      <td>145</td>
      <td>448</td>
      <td>411</td>
      <td>14093</td>
      <td>11208</td>
      <td>79.5</td>
      <td>1305</td>
      <td>80.0</td>
      <td>3.0</td>
      <td>2</td>
      <td>481</td>
      <td>342</td>
      <td>68</td>
      <td>488</td>
      <td>7</td>
      <td>9</td>
      <td>3</td>
      <td>3696</td>
      <td>803</td>
      <td>794</td>
      <td>50.3</td>
    </tr>
    <tr>
      <th>Werder Bremen</th>
      <td>26413</td>
      <td>0.235294</td>
      <td>175</td>
      <td>109</td>
      <td>61.1</td>
      <td>4</td>
      <td>11.8</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>419</td>
      <td>135</td>
      <td>32.2</td>
      <td>12.32</td>
      <td>3.97</td>
      <td>0.09</td>
      <td>0.27</td>
      <td>17.7</td>
      <td>10</td>
      <td>3</td>
      <td>6</td>
      <td>12979</td>
      <td>16581</td>
      <td>78.3</td>
      <td>260600</td>
      <td>90656</td>
      <td>4973</td>
      <td>5759</td>
      <td>86.4</td>
      <td>5668</td>
      <td>6622</td>
      <td>85.6</td>
      <td>2125</td>
      <td>3530</td>
      <td>60.2</td>
      <td>311</td>
      <td>921</td>
      <td>249</td>
      <td>...</td>
      <td>10</td>
      <td>48.8</td>
      <td>20864</td>
      <td>2519</td>
      <td>7265</td>
      <td>10088</td>
      <td>4783</td>
      <td>704</td>
      <td>19079</td>
      <td>278</td>
      <td>487</td>
      <td>57.1</td>
      <td>296</td>
      <td>17</td>
      <td>12939</td>
      <td>65281</td>
      <td>34516</td>
      <td>1247</td>
      <td>392</td>
      <td>98</td>
      <td>453</td>
      <td>403</td>
      <td>15465</td>
      <td>12979</td>
      <td>83.9</td>
      <td>1472</td>
      <td>80.0</td>
      <td>4.0</td>
      <td>4</td>
      <td>462</td>
      <td>450</td>
      <td>52</td>
      <td>386</td>
      <td>4</td>
      <td>0</td>
      <td>3</td>
      <td>3122</td>
      <td>518</td>
      <td>619</td>
      <td>45.6</td>
    </tr>
    <tr>
      <th>West Ham</th>
      <td>44155</td>
      <td>0.263158</td>
      <td>178</td>
      <td>124</td>
      <td>68.0</td>
      <td>7</td>
      <td>18.4</td>
      <td>6</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
      <td>16.7</td>
      <td>414</td>
      <td>157</td>
      <td>37.9</td>
      <td>10.89</td>
      <td>4.13</td>
      <td>0.11</td>
      <td>0.29</td>
      <td>15.6</td>
      <td>13</td>
      <td>4</td>
      <td>4</td>
      <td>12388</td>
      <td>16488</td>
      <td>75.1</td>
      <td>240804</td>
      <td>90754</td>
      <td>5516</td>
      <td>6384</td>
      <td>86.4</td>
      <td>4620</td>
      <td>5666</td>
      <td>81.5</td>
      <td>1949</td>
      <td>3610</td>
      <td>54.0</td>
      <td>318</td>
      <td>972</td>
      <td>259</td>
      <td>...</td>
      <td>11</td>
      <td>44.0</td>
      <td>20825</td>
      <td>2288</td>
      <td>6477</td>
      <td>9965</td>
      <td>5580</td>
      <td>823</td>
      <td>19019</td>
      <td>406</td>
      <td>645</td>
      <td>62.9</td>
      <td>429</td>
      <td>23</td>
      <td>12519</td>
      <td>66314</td>
      <td>33396</td>
      <td>1350</td>
      <td>437</td>
      <td>155</td>
      <td>399</td>
      <td>408</td>
      <td>15315</td>
      <td>12388</td>
      <td>80.9</td>
      <td>1377</td>
      <td>64.0</td>
      <td>1.0</td>
      <td>1</td>
      <td>386</td>
      <td>345</td>
      <td>66</td>
      <td>470</td>
      <td>3</td>
      <td>6</td>
      <td>3</td>
      <td>3536</td>
      <td>808</td>
      <td>781</td>
      <td>50.8</td>
    </tr>
    <tr>
      <th>Wolfsburg</th>
      <td>18621</td>
      <td>0.382353</td>
      <td>140</td>
      <td>98</td>
      <td>70.7</td>
      <td>8</td>
      <td>23.5</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>466</td>
      <td>155</td>
      <td>33.3</td>
      <td>13.71</td>
      <td>4.56</td>
      <td>0.09</td>
      <td>0.28</td>
      <td>17.5</td>
      <td>11</td>
      <td>4</td>
      <td>4</td>
      <td>11716</td>
      <td>15547</td>
      <td>75.4</td>
      <td>251266</td>
      <td>92108</td>
      <td>4026</td>
      <td>4863</td>
      <td>82.8</td>
      <td>5167</td>
      <td>6249</td>
      <td>82.7</td>
      <td>2312</td>
      <td>3777</td>
      <td>61.2</td>
      <td>333</td>
      <td>915</td>
      <td>253</td>
      <td>...</td>
      <td>12</td>
      <td>48.3</td>
      <td>19911</td>
      <td>2102</td>
      <td>6576</td>
      <td>9616</td>
      <td>4946</td>
      <td>787</td>
      <td>18132</td>
      <td>388</td>
      <td>617</td>
      <td>62.9</td>
      <td>414</td>
      <td>30</td>
      <td>11921</td>
      <td>62106</td>
      <td>34411</td>
      <td>1300</td>
      <td>363</td>
      <td>141</td>
      <td>469</td>
      <td>469</td>
      <td>14309</td>
      <td>11716</td>
      <td>81.9</td>
      <td>1601</td>
      <td>71.0</td>
      <td>4.0</td>
      <td>2</td>
      <td>491</td>
      <td>399</td>
      <td>72</td>
      <td>417</td>
      <td>3</td>
      <td>4</td>
      <td>0</td>
      <td>3510</td>
      <td>653</td>
      <td>564</td>
      <td>53.7</td>
    </tr>
    <tr>
      <th>Wolves</th>
      <td>24758</td>
      <td>0.394737</td>
      <td>120</td>
      <td>80</td>
      <td>67.5</td>
      <td>13</td>
      <td>34.2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>66.7</td>
      <td>453</td>
      <td>142</td>
      <td>31.3</td>
      <td>11.92</td>
      <td>3.74</td>
      <td>0.10</td>
      <td>0.32</td>
      <td>16.9</td>
      <td>12</td>
      <td>4</td>
      <td>4</td>
      <td>14072</td>
      <td>17895</td>
      <td>78.6</td>
      <td>297687</td>
      <td>97790</td>
      <td>5172</td>
      <td>5988</td>
      <td>86.4</td>
      <td>6003</td>
      <td>7071</td>
      <td>84.9</td>
      <td>2685</td>
      <td>4175</td>
      <td>64.3</td>
      <td>327</td>
      <td>1015</td>
      <td>229</td>
      <td>...</td>
      <td>13</td>
      <td>48.3</td>
      <td>22382</td>
      <td>2106</td>
      <td>7297</td>
      <td>10931</td>
      <td>5458</td>
      <td>840</td>
      <td>20636</td>
      <td>519</td>
      <td>820</td>
      <td>63.3</td>
      <td>562</td>
      <td>32</td>
      <td>14114</td>
      <td>70477</td>
      <td>40243</td>
      <td>1645</td>
      <td>450</td>
      <td>212</td>
      <td>445</td>
      <td>454</td>
      <td>16703</td>
      <td>14072</td>
      <td>84.2</td>
      <td>1361</td>
      <td>61.0</td>
      <td>2.0</td>
      <td>2</td>
      <td>406</td>
      <td>361</td>
      <td>49</td>
      <td>476</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>3569</td>
      <td>719</td>
      <td>701</td>
      <td>50.6</td>
    </tr>
  </tbody>
</table>
<p>213 rows × 112 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-522b8b6a-d654-4fa4-b79d-fc58e44f0dab')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-522b8b6a-d654-4fa4-b79d-fc58e44f0dab button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-522b8b6a-d654-4fa4-b79d-fc58e44f0dab');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
target = df['WinRate']
df = df.drop('WinRate', axis=1)
corr = df.corrwith(target)
```


```python
corr[abs(corr) > 0.65].sort_values()
```




    Sh/90           0.654715
    CS              0.654907
    L_Cmp%          0.655662
    S_Att           0.655792
    Live            0.657479
    S_Cmp           0.658850
    M_Att           0.662739
    Carries         0.668448
    M_Cmp           0.669231
    Att 3rd         0.670556
    T_Att           0.670747
    CS%             0.673465
    Targ            0.679429
    PPA             0.680624
    Mid 3rd         0.680819
    CPA             0.683569
    Carry_Prog      0.684948
    Pass_TotDist    0.686604
    T_Cmp           0.689072
    Rec             0.689075
    SCA90           0.691535
    G/Sh            0.692057
    Att Pen         0.697484
    Prog            0.699864
    Poss            0.710068
    1/3             0.723149
    SoT             0.747170
    SoT/90          0.783675
    dtype: float64




```python
corr[abs(corr) < 0.2].sort_values()
```




    PKA          -0.195442
    CrdR         -0.195196
    OG           -0.179986
    D_Tkl+Past   -0.179860
    PKcon        -0.176121
    P_Mid 3rd    -0.166088
    Tkl+Int      -0.165753
    Pass         -0.164547
    Def Pen      -0.162214
    Int          -0.150137
    Tkl          -0.128004
    2CrdY        -0.127298
    PKsv         -0.118750
    Mis          -0.116459
    Fld          -0.092771
    D_Tkl        -0.086208
    PK_Save%     -0.070094
    ShSv         -0.068813
    TklW         -0.052986
    Err          -0.039633
    Dis          -0.031435
    Recov         0.010678
    S_PassDead    0.049503
    Press_Succ    0.075988
    PKm           0.096081
    Tkl%          0.126700
    CrsPA         0.130148
    T_Mid 3rd     0.140116
    Def 3rd       0.160814
    S_Def         0.166992
    S_Fld         0.191666
    dtype: float64




```python
corr[corr < 0].sort_values(ascending=False)
```




    Dis          -0.031435
    Err          -0.039633
    TklW         -0.052986
    ShSv         -0.068813
    PK_Save%     -0.070094
    D_Tkl        -0.086208
    Fld          -0.092771
    Mis          -0.116459
    PKsv         -0.118750
    2CrdY        -0.127298
    Tkl          -0.128004
    Int          -0.150137
    Def Pen      -0.162214
    Pass         -0.164547
    Tkl+Int      -0.165753
    P_Mid 3rd    -0.166088
    PKcon        -0.176121
    D_Tkl+Past   -0.179860
    OG           -0.179986
    CrdR         -0.195196
    PKA          -0.195442
    PK_PKatt     -0.200914
    Past         -0.206787
    CrdY         -0.213047
    Won          -0.218149
    Press        -0.239075
    Blocks       -0.261149
    Fls          -0.274426
    Block_Sh     -0.326166
    Lost         -0.382253
    Dist         -0.383504
    Clr          -0.400264
    T_Def 3rd    -0.407481
    Saves        -0.415856
    P_Def 3rd    -0.493299
    SoTA         -0.577844
    dtype: float64




```python
lm1 = LinearRegression()

X = df
Y = target
lm1.fit(X,Y)

print('lm.intercept_ :', lm1.intercept_)
print('lm.coef_ :', lm1.coef_)

Y_hat = lm1.predict(X)
print('Train MSE :', mean_squared_error(Y, Y_hat))
print('Train average error :', abs(Y.values - Y_hat).mean())
```

    lm.intercept_ : -2.25727197295143
    lm.coef_ : [ 4.86267727e-07 -1.12560140e-03  6.50646123e-04  3.90732048e-03
     -2.57516665e-02  1.19647400e-02  1.08996657e-03 -6.19379826e-03
     -8.67757603e-03  1.59613409e-02  5.40627178e-05  2.04982790e-03
     -1.78824326e-03  1.17967130e-02 -1.44591594e-02  1.21173489e-02
      5.97019229e-01  6.21048146e-01  6.69990416e-03  2.64471522e-03
      8.55183390e-03 -7.32099381e-03 -1.11618339e-02 -1.28638514e-04
     -9.84626396e-03  9.51575596e-06  8.91470664e-07 -1.69865869e-04
      1.50673213e-04  1.36186331e-02  3.36787076e-04 -3.91331803e-04
     -4.03449915e-02 -1.88735202e-04 -2.66907419e-05 -5.94353817e-03
      3.34911077e-04 -4.88010261e-06 -1.74060995e-04  8.73295800e-04
      2.49613000e-04 -9.96704159e-04  3.68544942e-02 -6.71454332e-04
      1.11229481e-03 -4.78262797e-04 -1.20250154e-03 -1.38288386e-03
      1.62610357e-03 -5.20830766e-05  3.61455899e-04 -4.21848005e-04
      1.45245866e-04  2.24519059e-04 -1.27091909e-03 -1.95569797e-04
      1.41222104e-02  1.07534929e-03  3.43221544e-05 -1.27287590e-04
      8.74024518e-04  4.27450683e-06 -3.08292460e-05  6.08768365e-05
     -1.68503990e-04 -3.35897272e-04 -2.56904684e-03  1.67393287e-04
     -3.02971237e-06 -5.51127792e-05 -3.59512218e-05  6.09117545e-04
     -4.84336970e-03 -1.66361550e-05  3.57913528e-05 -4.86441123e-05
     -5.61006637e-05 -6.98064333e-05  2.91088263e-06  1.39310065e-04
     -1.98973781e-03  1.09815861e-03  1.34317599e-02  2.19108637e-05
     -9.05294451e-04 -7.67350382e-08  1.11469539e-07  6.92213017e-07
      5.90469992e-05  9.96622577e-05  5.46755178e-04  1.00713030e-04
     -1.47868847e-04  1.77041599e-04  1.09582545e-02  3.54283640e-02
     -1.84816707e-04 -9.08095007e-05 -1.64440228e-03  1.54640392e-03
     -8.60823679e-05  3.00327791e-04  3.90657367e-04 -4.39665928e-04
      5.80428490e-03  6.95430543e-03 -6.04788418e-03 -1.03141059e-05
      1.50779067e-04  1.67241023e-05 -5.17572014e-04]
    Train MSE : 0.0013163307504299726
    Train average error : 0.02807862652284155
    


```python
lm2 = LinearRegression()

X = df[corr[abs(corr) > 0.65].index]
Y = target
lm2.fit(X,Y)

print('lm.intercept_ :', lm2.intercept_)
print('lm.coef_ :', lm2.coef_)

Y_hat = lm2.predict(X)
print('Train MSE :', mean_squared_error(Y, Y_hat))
print('Train average error :', abs(Y.values - Y_hat).mean())
```

    lm.intercept_ : 0.1327841496283367
    lm.coef_ : [-1.21400353e-02  1.04449490e-02  1.53186607e-03  1.55687134e-02
     -4.25509886e-02  2.25965937e+00  1.46388376e-03 -1.86578069e-04
      3.75085989e-08 -2.65812736e-04  1.33205539e-04 -2.31424961e-04
      9.91132156e-05 -9.11402423e-03  1.17644279e-04  2.06102166e-04
     -3.73952313e-05  2.65525673e-03  4.08082573e-03  1.78823389e-05
     -1.29957493e-06 -6.79436124e-05  1.70749160e-05 -1.62614024e-05
     -7.22198036e-05  4.38060083e-04  1.10374132e-05 -1.17754611e-03]
    Train MSE : 0.0028640960706704304
    Train average error : 0.041949344622951086
    


```python
lm3 = LinearRegression()

X = df[corr[abs(corr) < 0.2].index]
Y = target
lm3.fit(X,Y)

print('lm.intercept_ :', lm3.intercept_)
print('lm.coef_ :', lm3.coef_)

Y_hat = lm3.predict(X)
print('Train MSE :', mean_squared_error(Y, Y_hat))
print('Train average error :', abs(Y.values - Y_hat).mean())
```

    lm.intercept_ : -0.12214496493780364
    lm.coef_ : [-5.98180108e-03 -9.93492377e-04  2.79033010e-02 -4.11702141e-04
      1.57254989e-04 -1.99932815e-04  3.75251515e-03  4.60032406e-03
     -7.25205357e-04  6.71669108e-04  2.08994114e-03 -1.31291205e-03
      2.29717726e-04  1.13444398e-02  1.27535919e-04 -8.60228880e-05
     -5.13542164e-03  1.34771946e-04  3.59457956e-04 -3.65747401e-04
      1.83377035e-03 -2.20140808e-04  1.16640235e-04 -3.42226617e-04
     -3.44864146e-04 -1.19145034e-02  6.87816399e-03 -3.00894988e-04
      4.19967690e-03 -1.08222294e-02  1.52342360e-05]
    Train MSE : 0.01152747639338757
    Train average error : 0.08527083919020652
    


```python
abs(Y.values - 0.4).mean()
```




    0.12646248626568107




```python
fig, axis = plt.subplots(1,2, figsize = (12,5))
sns.regplot(x=df['SoT/90'], y=target, ax=axis[0])
sns.regplot(x=df['1/3'], y=target, ax=axis[1])

plt.show()
```


    
![png](output_11_0.png)
    



```python
fig, axis = plt.subplots(1,2, figsize = (12,5))
sns.regplot(x=df['Recov'], y=target, ax=axis[0])
sns.regplot(x=df['Dis'], y=target, ax=axis[1])

plt.show()
```


    
![png](output_12_0.png)
    



```python
fig, axis = plt.subplots(1,2, figsize = (12,5))
sns.regplot(x=df['SoTA'], y=target, ax=axis[0])
sns.regplot(x=df['P_Def 3rd'], y=target, ax=axis[1])

plt.show()
```


    
![png](output_13_0.png)
    



```python
season = '2019-2020'

# Basic Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_stat = pd.DataFrame(columns=headers[1:20])

for i in table.find_all('tr')[1:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_stat.loc[len(df_stat)] = row
  
df_stat = df_stat.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_stat = df_stat.drop(columns=['Country', 'Top Team Scorer',	'Goalkeeper'])
df_stat['Attendance'] = df_stat['Attendance'].str.replace(",", "")
df_stat = df_stat.apply(pd.to_numeric)
df_stat['WinRate'] = df_stat['W']/df_stat['MP']
df_stat = df_stat.drop(columns=['LgRk', 'MP', 'W', 'D', 'L', 'GF', 'GA', 'GD', 'Pts', 'Pts/G', 'xG', 'xGA', 'xGD', 'xGD/90'])

# Goalkeeping Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/keepers/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_goalkeep = pd.DataFrame(columns=headers[5:27])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_goalkeep.loc[len(df_goalkeep)] = row

df_goalkeep = df_goalkeep.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_goalkeep = df_goalkeep.drop(columns=['Comp'])
df_goalkeep['Min'] = df_goalkeep['Min'].str.replace(",", "")
df_goalkeep = df_goalkeep.apply(pd.to_numeric)
df_goalkeep = df_goalkeep.drop(columns=['# Pl', 'MP', 'Starts', 'Min', '90s', 'GA', 'GA90', 'W', 'D', 'L'])
df_goalkeep.columns = ['SoTA', 'Saves', 'Save%', 'CS', 'CS%', 'PK_PKatt', 'PKA', 'PKsv', 'PKm', 'PK_Save%']

# Shooting Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/shooting/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_shoot = pd.DataFrame(columns=headers[5:26])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_shoot.loc[len(df_shoot)] = row

df_shoot = df_shoot.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_shoot = df_shoot.drop(columns=['Comp'])
df_shoot = df_shoot.apply(pd.to_numeric)
df_shoot = df_shoot.drop(columns=['# Pl', '90s', 'Gls', 'xG', 'npxG', 'npxG/Sh', 'G-xG', 'np:G-xG'])

# Passing Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/passing/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_pass = pd.DataFrame(columns=headers[8:34])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_pass.loc[len(df_pass)] = row

df_pass = df_pass.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_pass = df_pass.drop(columns=['Comp'])
df_pass = df_pass.apply(pd.to_numeric)
df_pass = df_pass.drop(columns=['# Pl', '90s', 'Ast', 'xA', 'A-xA'])
df_pass.columns = ['T_Cmp', 'T_Att', 'T_Cmp%', 'Pass_TotDist', 'Pass_PrgDist', 'S_Cmp', 'S_Att', 'S_Cmp%', 'M_Cmp', 'M_Att', 'M_Cmp%', 'L_Cmp', 'L_Att', 'L_Cmp%', 'KP', '1/3', 'PPA', 'CrsPA', 'Prog']

# Goal and Shot Creation Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/gca/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_gca = pd.DataFrame(columns=headers[7:27])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_gca.loc[len(df_gca)] = row

df_gca = df_gca.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_gca = df_gca.drop(columns=['Comp'])
df_gca = df_gca.apply(pd.to_numeric)
df_gca = df_gca.drop(columns=['# Pl', '90s'])
df_gca.columns = ['SCA', 'SCA90', 'S_PassLive', 'S_PassDead', 'S_Drib', 'S_Sh', 'S_Fld', 'S_Def', 'GCA', 'GCA90', 'G_PassLive', 'G_PassDead', 'G_Drib', 'G_Sh', 'G_Fld', 'G_Def']
df_gca = df_gca.drop(columns=['GCA', 'GCA90', 'G_PassLive', 'G_PassDead', 'G_Drib', 'G_Sh', 'G_Fld', 'G_Def'])

# Defensive Actions Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/defense/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_defense = pd.DataFrame(columns=headers[8:35])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_defense.loc[len(df_defense)] = row

df_defense = df_defense.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_defense = df_defense.drop(columns=['Comp'])
df_defense = df_defense.apply(pd.to_numeric)
df_defense = df_defense.drop(columns=['# Pl', '90s'])
df_defense.columns = ['Tkl', 'TklW', 'T_Def 3rd', 'T_Mid 3rd', 'T_Att 3rd', 'D_Tkl', 'D_Tkl+Past', 'Tkl%', 'Past', 'Press', 'Press_Succ', '%', 'P_Def 3rd', 'P_Mid 3rd', 'P_Att 3rd', 'Blocks', 'Block_Sh', 'ShSv', 'Pass', 'Int', 'Tkl+Int', 'Clr', 'Err']

# Possession Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/possession/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_possess = pd.DataFrame(columns=headers[7:36])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_possess.loc[len(df_possess)] = row

df_possess = df_possess.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_possess = df_possess.drop(columns=['Comp'])
df_possess = df_possess.apply(pd.to_numeric)
df_possess = df_possess.drop(columns=['# Pl', '90s'])
df_possess.columns = ['Poss', 'Touches', 'Def Pen', 'Def 3rd', 'Mid 3rd', 'Att 3rd', 'Att Pen', 'Live', 'Succ', 'Att', 'Succ%', '#Pl', 'Megs', 'Carries', 'TotDist', 'PrgDist', 'Carry_Prog', 'Carry_1/3', 'CPA', 'Mis', 'Dis', 'Targ', 'Rec', 'Rec%', 'Receive_Prog']

# Miscellaneous Stats
url = 'https://fbref.com/en/comps/Big5/'+season+'/misc/squads/'+season+'-Big-5-European-Leagues-Stats'

response = requests.get(url)
html = response.text
soup = BeautifulSoup(html, 'html.parser')
tables = soup.find_all(name='table')
for table in tables :
  headers = [th.text for th in table.find_all('th')]

table = tables[0]
headers = [th.text for th in table.find_all('th')]

df_misc = pd.DataFrame(columns=headers[5:25])

for i in table.find_all('tr')[2:] :
  data = i.find_all('td')
  row = [tr.text.strip() for tr in data]
  df_misc.loc[len(df_misc)] = row

df_misc = df_misc.set_index('Squad', drop=True).rename_axis(None).sort_index()
df_misc = df_misc.drop(columns=['Comp'])
df_misc = df_misc.apply(pd.to_numeric)
df_misc = df_misc.drop(columns=['# Pl', '90s', 'Int', 'TklW'])

df_test = pd.concat((df_stat, df_goalkeep, df_shoot, df_pass, df_gca, df_defense, df_possess, df_misc), axis=1)
```


```python
df_test = df_test.dropna()
target_test = df_test['WinRate']
df_test = df_test.drop('WinRate', axis=1)
```


```python
X = df_test
Y = target_test

Y_hat = lm1.predict(X)
print('Train MSE :', mean_squared_error(Y, Y_hat))
print('Train average error :', abs(Y.values - Y_hat).mean())
```

    Train MSE : 0.0014894605387130646
    Train average error : 0.029382061787621
    
